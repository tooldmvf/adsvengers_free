SELECT b.last_name
,sum(amount_revenue_approved) as revenue
,sum(amount_spent) as spent
,sum(amount_revenue_approved)-sum(amount_spent) as Profit
,(sum(amount_revenue_approved) -sum(amount_spent))/(case when sum(amount_spent) = 0 then 1 else sum(amount_spent) end)*100 as Roi
FROM public.user_totals_month a
INNER JOIN public.user_profiles b ON (B.fk_user_id = a.fk_user_id)
Where 1=1
and (text(a.fk_user_id) IN ({{"'" + MultiSelectUsers.selectedOptionValues.join("', '") + "'"}}) OR text(a.fk_user_id) = '{{appsmith.store.myUser}}' )
and substring(financial_month,1,4) = '{{SelectYear.selectedOptionValue}}'
group by last_name 
HAVING (sum(amount_revenue_approved)-sum(amount_spent) <> 0)
order by 1